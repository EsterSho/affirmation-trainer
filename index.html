<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Тренажёр утверждений</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Иконка -->
  <link rel="icon" type="image/png" href="icon.png">
  <!-- Если у тебя .ico, используй:
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  -->
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen p-4">

<div class="max-w-3xl mx-auto">
  <header class="mb-4">
    <h1 class="text-2xl font-bold">Тренажёр утверждений</h1>
    <p class="text-sm text-slate-300">Сохраняется оффлайн · ритуал силы</p>
  </header>

  <section class="bg-slate-700 p-4 rounded mb-4">
    <h2 class="font-semibold mb-2">Твои 3 утверждения</h2>
    <div id="affirmations-list" class="space-y-3"></div>
    <div class="mt-3 flex gap-2">
      <button id="reset-day" class="bg-slate-600 px-3 py-2 rounded">Сброс дня</button>
      <button id="reset-all" class="bg-red-600 px-3 py-2 rounded">Сброс всех утверждений</button>
    </div>
  </section>

  <section class="bg-slate-700 p-4 rounded">
    <h2 class="font-semibold mb-2">Прогресс</h2>
    <div id="today-count" class="text-lg font-bold mb-2"></div>
    <div class="h-24 flex items-end gap-1" id="mini-bar-chart"></div>
  </section>
</div>

<script>
  const STORAGE_KEYS = {
    AFF: 'affirmations_v1',
    HISTORY: 'affirmations_history_v1'
  };

  const DEFAULT_AFFIRMATIONS = [
    "Моё тело обновляется и исцеляется. Я молод, силён и полон энергии.",
    "Я живу в изобилии и любви Вселенной. Все ресурсы доступны мне.",
    "Я люблю и ценю себя. Я готов к гармоничным отношениям в идеальное время."
  ];

  function todayKey() {
    return new Date().toISOString().slice(0,10);
  }

  function loadJSON(key, fallback) {
    try {
      const raw = localStorage.getItem(key);
      return raw ? JSON.parse(raw) : fallback;
    } catch {
      return fallback;
    }
  }

  function saveJSON(key, data) {
    localStorage.setItem(key, JSON.stringify(data));
  }

  let affirmations = loadJSON(STORAGE_KEYS.AFF, DEFAULT_AFFIRMATIONS);
  let history = loadJSON(STORAGE_KEYS.HISTORY, {});

  function increment(idx) {
    const t = todayKey();
    if (!history[t]) history[t] = [0,0,0];
    history[t][idx]++;
    saveJSON(STORAGE_KEYS.HISTORY, history);
    renderAffirmations();
    renderProgress();
  }

  function resetToday() {
    const t = todayKey();
    history[t] = [0,0,0];
    saveJSON(STORAGE_KEYS.HISTORY, history);
    renderAffirmations();
    renderProgress();
  }

  function resetAll() {
    localStorage.removeItem(STORAGE_KEYS.AFF);
    localStorage.removeItem(STORAGE_KEYS.HISTORY);
    affirmations = [...DEFAULT_AFFIRMATIONS];
    history = {};
    renderAffirmations();
    renderProgress();
  }

  function renderAffirmations() {
    const container = document.getElementById('affirmations-list');
    container.innerHTML = '';
    const t = todayKey();
    affirmations.forEach((text, idx) => {
      const count = (history[t] || [0,0,0])[idx] || 0;
      const div = document.createElement('div');
      div.className = 'bg-slate-800 p-3 rounded flex justify-between items-center';
      div.innerHTML = `
        <div>${text}<div class="text-xs text-slate-400 mt-1">Сколько раз сегодня: ${count}</div></div>
        <button class="bg-emerald-500 hover:bg-emerald-600 rounded-full w-12 h-12 font-bold">✅</button>
      `;
      div.querySelector('button').onclick = () => increment(idx);
      container.appendChild(div);
    });
  }

  function renderProgress() {
    const t = todayKey();
    const todaySum = (history[t] || [0,0,0]).reduce((a,b)=>a+b,0);
    document.getElementById('today-count').textContent = `Сегодня повторов: ${todaySum}`;

    // mini-bar-chart
    const chart = document.getElementById('mini-bar-chart');
    chart.innerHTML = '';
    for (let i=29;i>=0;i--) {
      const d = new Date();
      d.setDate(d.getDate()-i);
      const key = d.toISOString().slice(0,10);
      const sum = (history[key] || [0,0,0]).reduce((a,b)=>a+b,0);
      const h = Math.max(4, Math.min(sum*20,100));
      const bar = document.createElement('div');
      bar.className = 'flex-1 rounded bg-emerald-400/80';
      bar.style.height = h+'%';
      bar.title = `${key}: ${sum}`;
      chart.appendChild(bar);
    }
  }

  document.getElementById('reset-day').onclick = resetToday;
  document.getElementById('reset-all').onclick = resetAll;

  renderAffirmations();
  renderProgress();
</script>

</body>
</html>
