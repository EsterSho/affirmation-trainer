<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ğ¢Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€ ÑƒÑ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğ¹</title>
<style>
Â  body { font-family: sans-serif; background: #1e293b; color: #f1f5f9; margin:0; padding:0; }
Â  .container { padding: 12px; max-width: 480px; margin: auto; }
Â  .affirmation { background: #334155; padding:10px 12px; border-radius:8px; margin-bottom:8px; display:flex; justify-content: space-between; align-items:center; }
Â  .affirm-text { flex:1; margin-right:8px; padding-top: 4px; }
Â  .affirm-count { font-size:12px; color:#94a3b8; text-align:right; }
Â  button { cursor:pointer; border:none; border-radius:6px; padding:6px 10px; font-size:14px; }
Â  .btn-green { background:#16a34a; color:white; }
Â  .btn-green:hover { background:#15803d; }
Â  .btn-gray { background:#475569; color:white; }
Â  .stats { display:flex; justify-content:space-between; margin:12px 0; font-size:14px; }
Â  .modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:flex; justify-content:center; align-items:center; }
Â  .modal-content { background:white; color:#1e293b; width:90%; max-width:400px; max-height:90%; overflow-y:auto; padding:12px; border-radius:10px; }
Â  .modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
Â  .modal textarea { width:100%; margin-bottom:6px; border-radius:6px; padding:4px; font-size:14px; }
Â  .slide img { width:100%; border-radius:6px; margin-top:6px; }
Â  .ritual-line { display:flex; justify-content:space-between; align-items:center; margin-bottom:4px; background:#f1f5f9; padding:4px 6px; border-radius:4px; }
Â  .ritual-line button { background:#ef4444; color:white; padding:2px 6px; font-size:12px; }
Â  input[type="file"] { font-size:12px; }
Â  canvas { width:100% !important; height:200px !important; background:#334155; border-radius:8px; margin-top:16px; }
Â  .ritual-line { display:flex; gap:6px; align-items:flex-start; }
.ritual-line textarea{
Â  flex:1;
Â  border:none;
Â  background:transparent;
Â  resize:vertical;
Â  overflow:hidden;
Â  padding:6px;
Â  font-size:14px;
Â  line-height:1.4;
Â  max-height:200px;
}
.ritual-line textarea:focus{ outline:none; }
Â  .modal-content{ -webkit-overflow-scrolling: touch; }
</style>
Â  <link rel="apple-touch-icon" href="icon.png">
</head>
<body>

<div class="container">
Â  <h1 style="text-align:center;margin-bottom:12px;">Ğ¢Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€ ÑƒÑ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğ¹</h1>

Â  Â  <div class="stats">
Â  Â  <div>Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ: <span id="today-count">0 Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ²</span></div>
Â  Â  <div>Ğ¡Ñ‚Ñ€Ğ¸Ğº: <span id="streak-count">0 Ğ´Ğ½.</span></div>
Â  </div>

Â  Â  <div id="permanent-affirmations"></div>

Â  Â  <h3>Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾</h3>
Â  <div id="editable-affirmations"></div>
Â  <button id="add-affirm" class="btn-gray" style="width:100%;margin-bottom:12px;">Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒÑ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ</button>

Â  Â  <button id="open-ritual" class="btn-green" style="width:100%;margin-bottom:12px;">Ğ Ğ¸Ñ‚ÑƒĞ°Ğ»</button>

Â  Â  <button id="reset-day" class="btn-gray" style="width:100%;margin-bottom:12px;">Ğ¡Ğ±Ñ€Ğ¾Ñ Ğ´Ğ½Ñ</button>

Â  Â  <canvas id="progressChart"></canvas>
<div id="stats" style="margin-top:15px; font-size:14px; text-align:left; color:#f1f5f9;"></div>
</div>

<div id="ritual-modal" class="modal" style="display:none;">
Â  <div class="modal-content">
Â  Â  <div class="modal-header">
Â  Â  Â  <h3>Ğ Ğ¸Ñ‚ÑƒĞ°Ğ»</h3>
Â  Â  Â  <button id="close-ritual">âœ–</button>
Â  Â  </div>

Â  Â  Â  Â  <div class="slide" id="ritual-slide"></div>
Â  Â  <input type="file" id="upload-slide">
Â  Â  <button id="clear-slide" class="btn-gray" style="width:100%;margin:6px 0;">ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ ÑĞ»Ğ°Ğ¹Ğ´</button>

Â  Â  Â  Â  <div id="ritual-text"></div>
Â  Â  <input type="text" id="new-ritual-line" placeholder="ĞĞ¾Ğ²Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ°">
Â  Â  <button id="add-ritual-line" class="btn-green" style="width:100%;margin:6px 0;">Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ğ¾ĞºÑƒ</button>
Â  Â  <button id="save-ritual" class="btn-green" style="width:100%;margin-bottom:6px;">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ñ€Ğ¸Ñ‚ÑƒĞ°Ğ»</button>
Â  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ====== ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ======
const STORAGE_KEYS = {
Â  AFF: 'affirm_trainer_affirmations_v1',
Â  HISTORY: 'affirm_trainer_history_v1',
Â  RITUAL: 'affirm_trainer_ritual_v1',
Â  SLIDE: 'affirm_trainer_slide_v1'
};

// Ğ•Ğ´Ğ¸Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ ĞºĞ»ÑÑ‡Ğ° Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ (YYYY-MM-DD)
const todayKey = () => new Date().toISOString().slice(0, 10);

// ====== Ğ’ĞµÑ‡Ğ½Ñ‹Ğµ ÑƒÑ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ ======
const permanentAffirmations = [
Â  "ĞœĞ¾Ñ‘ Ñ‚ĞµĞ»Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ¸ Ğ¸ÑÑ†ĞµĞ»ÑĞµÑ‚ÑÑ. Ğ¯ Ğ¼Ğ¾Ğ»Ğ¾Ğ´, ÑĞ¸Ğ»Ñ‘Ğ½ Ğ¸ Ğ¿Ğ¾Ğ»Ğ¾Ğ½ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸.",
Â  "Ğ¯ Ğ¶Ğ¸Ğ²Ñƒ Ğ² Ğ¸Ğ·Ğ¾Ğ±Ğ¸Ğ»Ğ¸Ğ¸ Ğ¸ Ğ»ÑĞ±Ğ²Ğ¸ Ğ’ÑĞµĞ»ĞµĞ½Ğ½Ğ¾Ğ¹. Ğ’ÑĞµ Ñ€ĞµÑÑƒÑ€ÑÑ‹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹ Ğ¼Ğ½Ğµ.",
Â  "Ğ¯ Ğ»ÑĞ±Ğ»Ñ Ğ¸ Ñ†ĞµĞ½Ñ ÑĞµĞ±Ñ. Ğ¯ Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğº Ğ³Ğ°Ñ€Ğ¼Ğ¾Ğ½Ğ¸Ñ‡Ğ½Ñ‹Ğ¼ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸ÑĞ¼ Ğ² Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ."
];

// ====== Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ ======
let history = JSON.parse(localStorage.getItem(STORAGE_KEYS.HISTORY)||'{}');
if(!history[todayKey()]) history[todayKey()] = Array(permanentAffirmations.length).fill(0);

function saveHistory(){Â 
Â  localStorage.setItem(STORAGE_KEYS.HISTORY, JSON.stringify(history));Â 
Â  updateStats();Â 
Â  renderChart();
}

// ====== Ğ ĞµĞ½Ğ´ĞµÑ€ Ğ²ĞµÑ‡Ğ½Ñ‹Ñ… ÑƒÑ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğ¹ ======
function renderPermanent(){
Â  const container = document.getElementById('permanent-affirmations');
Â  container.innerHTML='';
Â  permanentAffirmations.forEach((text,i)=>{
Â  Â  const div = document.createElement('div');
Â  Â  div.className='affirmation';
Â  Â  div.innerHTML = `<div class="affirm-text">${text}<div class="affirm-count" id="count-perm-${i}">${history[todayKey()][i]}</div></div>
Â  Â  Â  <button class="btn-green" data-idx="${i}">âœ…</button>`;
Â  Â  container.appendChild(div);
Â  Â  div.querySelector('button').onclick = ()=>{
Â  Â  Â  if(!history[todayKey()]) history[todayKey()] = Array(permanentAffirmations.length+editableAffirmations.length).fill(0);
Â  Â  Â  history[todayKey()][i]++;
Â  Â  Â  saveHistory();
Â  Â  Â  document.getElementById(`count-perm-${i}`).innerText = history[todayKey()][i];
Â  Â  };
Â  });
}

// ====== Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğµ ÑƒÑ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ ======
let editableAffirmations = JSON.parse(localStorage.getItem(STORAGE_KEYS.AFF)||'[]');
function renderEditable(){
Â  const container = document.getElementById('editable-affirmations');
Â  container.innerHTML='';
Â  editableAffirmations.forEach((text,i)=>{
Â  Â  const div = document.createElement('div');
Â  Â  div.className='affirmation';
Â  Â  div.innerHTML = `<input type="text" value="${text}" class="affirm-text">
Â  Â  Â  <div style="display:flex; flex-direction:column;align-items:flex-end;">
Â  Â  Â  Â  <div class="affirm-count" id="count-edit-${i}">${history[todayKey()][i+3]||0}</div>
Â  Â  Â  Â  <button class="btn-green" data-idx="${i}">âœ…</button>
Â  Â  Â  Â  <button class="btn-gray remove-affirm" data-idx="${i}">âœ–</button>
Â  Â  Â  </div>`;
Â  Â  container.appendChild(div);

Â  Â  div.querySelector('.affirm-text').onchange = (e)=>{
Â  Â  Â  editableAffirmations[i] = e.target.value;
Â  Â  Â  localStorage.setItem(STORAGE_KEYS.AFF, JSON.stringify(editableAffirmations));
Â  Â  };
Â  Â  div.querySelector('.btn-green').onclick = ()=>{
Â  Â  Â  if(!history[todayKey()]) history[todayKey()] = Array(permanentAffirmations.length+editableAffirmations.length).fill(0);
Â  Â  Â  history[todayKey()][i+3] = (history[todayKey()][i+3]||0)+1;
Â  Â  Â  saveHistory();
Â  Â  Â  document.getElementById(`count-edit-${i}`).innerText = history[todayKey()][i+3];
Â  Â  };
Â  Â  div.querySelector('.remove-affirm').onclick = ()=>{
Â  Â  Â  editableAffirmations.splice(i,1);
Â  Â  Â  localStorage.setItem(STORAGE_KEYS.AFF, JSON.stringify(editableAffirmations));
Â  Â  Â  renderEditable();
Â  Â  };
Â  });
}

document.getElementById('add-affirm').onclick = ()=>{
Â  editableAffirmations.push('ĞĞ¾Ğ²Ğ¾Ğµ ÑƒÑ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ');
Â  localStorage.setItem(STORAGE_KEYS.AFF, JSON.stringify(editableAffirmations));
Â  if(!history[todayKey()]) history[todayKey()] = [];
Â  history[todayKey()].push(0);
Â  saveHistory();
Â  renderEditable();
};

// ====== Ğ Ğ¸Ñ‚ÑƒĞ°Ğ» ======
let ritualText = JSON.parse(localStorage.getItem(STORAGE_KEYS.RITUAL)||'[]');
function renderRitual(){
Â  const container = document.getElementById('ritual-text');
Â  container.innerHTML = ritualText.map((line,idx)=>`
Â  Â  <div class="ritual-line">
Â  Â  Â  <textarea rows="1" class="ritual-textarea" data-idx="${idx}">${line}</textarea>
Â  Â  Â  <button data-idx="${idx}">âœ–</button>
Â  Â  </div>
Â  `).join('');

Â  const autosize = (el)=>{
Â  Â  el.style.height = 'auto';
Â  Â  el.style.height = Math.min(el.scrollHeight, 200) + 'px';
Â  };

Â  container.querySelectorAll('.ritual-textarea').forEach((ta)=>{
Â  Â  autosize(ta);
Â  Â  ta.addEventListener('input', (e)=>{
Â  Â  Â  const i = +e.target.dataset.idx;
Â  Â  Â  ritualText[i] = e.target.value;
Â  Â  Â  autosize(e.target);
Â  Â  });
Â  });

Â  container.querySelectorAll('button').forEach(btn=>{
Â  Â  btn.onclick = (e)=>{
Â  Â  Â  const idx = +e.target.dataset.idx;
Â  Â  Â  ritualText.splice(idx,1);
Â  Â  Â  renderRitual();
Â  Â  };
Â  });
}

document.getElementById('add-ritual-line').onclick = ()=>{
Â  const val = document.getElementById('new-ritual-line').value.trim();
Â  if(val){ ritualText.push(val); document.getElementById('new-ritual-line').value=''; renderRitual(); }
};

document.getElementById('save-ritual').onclick = ()=>{
Â  localStorage.setItem(STORAGE_KEYS.RITUAL, JSON.stringify(ritualText));
Â  alert('Ğ Ğ¸Ñ‚ÑƒĞ°Ğ» ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½!');
};

document.getElementById('open-ritual').onclick = ()=>{
Â  document.getElementById('ritual-modal').style.display='flex';
Â  renderRitual();
Â  const slide = localStorage.getItem(STORAGE_KEYS.SLIDE);
Â  if(slide) document.getElementById('ritual-slide').innerHTML = `<img src="${slide}">`;
};

document.getElementById('close-ritual').onclick = ()=>{
Â  document.getElementById('ritual-modal').style.display='none';
};

// ====== Ğ¡Ğ»Ğ°Ğ¹Ğ´ ======
document.getElementById('upload-slide').onchange = (e)=>{
Â  const file = e.target.files[0];
Â  if(file){
Â  Â  const reader = new FileReader();
Â  Â  reader.onload = function(evt){
Â  Â  Â  localStorage.setItem(STORAGE_KEYS.SLIDE, evt.target.result);
Â  Â  Â  document.getElementById('ritual-slide').innerHTML = `<img src="${evt.target.result}">`;
Â  Â  };
Â  Â  reader.readAsDataURL(file);
Â  }
};
document.getElementById('clear-slide').onclick = ()=>{
Â  localStorage.removeItem(STORAGE_KEYS.SLIDE);
Â  document.getElementById('ritual-slide').innerHTML='';
};

// ====== Ğ¡Ğ±Ñ€Ğ¾Ñ ======
document.getElementById('reset-day').onclick = ()=>{
Â  if(confirm('Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑĞ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ·Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ?')){
Â  Â  history[todayKey()] = Array(permanentAffirmations.length+editableAffirmations.length).fill(0);
Â  Â  saveHistory();
Â  Â  renderPermanent();
Â  Â  renderEditable();
Â  }
};

// ====== Ğ“Ñ€Ğ°Ñ„Ğ¸Ğº Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ° ======
let chart;

function getLast7Days() {
Â  let days = [];
Â  for (let i = 6; i >= 0; i--) {
Â  Â  let d = new Date();
Â  Â  d.setDate(d.getDate() - i);
Â  Â  days.push(d);
Â  }
Â  return days;
}

function renderChart() {
Â  const ctx = document.getElementById("progressChart").getContext("2d");
Â  const last7 = getLast7Days();

Â  const labels = last7.map(d => d.toLocaleDateString("ru-RU", { weekday: "short" }));
Â  const data = last7.map(d => {
Â  Â  const key = d.toISOString().slice(0, 10);
Â  Â  return (history[key] || []).reduce((a, b) => a + b, 0);
Â  });

Â  if (chart) chart.destroy();
Â  chart = new Chart(ctx, {
Â  Â  type: "line",
Â  Â  data: {
Â  Â  Â  labels,
Â  Â  Â  datasets: [{
Â  Â  Â  Â  label: "ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ñ‹ Ğ·Ğ° Ğ´ĞµĞ½ÑŒ",
Â  Â  Â  Â  data,
Â  Â  Â  Â  borderColor: "#16a34a",
Â  Â  Â  Â  backgroundColor: "#16a34a55",
Â  Â  Â  Â  fill: false,
Â  Â  Â  Â  tension: 0,
Â  Â  Â  Â  pointBackgroundColor: "#22c55e",
Â  Â  Â  Â  pointRadius: 6,
Â  Â  Â  Â  pointHoverRadius: 8
Â  Â  Â  }]
Â  Â  },
Â  Â  options: {
Â  Â  Â  responsive: true,
Â  Â  Â  maintainAspectRatio: false,
Â  Â  Â  scales: {
Â  Â  Â  Â  y: {
Â  Â  Â  Â  Â  beginAtZero: true,
Â  Â  Â  Â  Â  ticks: {
Â  Â  Â  Â  Â  Â  stepSize: 1
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  title: { display: true, text: "ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ñ‹" }
Â  Â  Â  Â  },
Â  Â  Â  Â  x: {
Â  Â  Â  Â  Â  title: { display: true, text: "Ğ”Ğ½Ğ¸ Ğ½ĞµĞ´ĞµĞ»Ğ¸" }
Â  Â  Â  Â  }
Â  Â  Â  },
Â  Â  Â  plugins: {
Â  Â  Â  Â  legend: { display: false }
Â  Â  Â  }
Â  Â  }
Â  });
}

// ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¿Ğ¾Ğ´ Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ¾Ğ¼
function updateStats() {
Â  const allDays = Object.keys(history);
Â  const totals = allDays.map(k => (history[k] || []).reduce((a, b) => a + b, 0));
Â  const total = totals.reduce((a, b) => a + b, 0);

Â  const avg = (total / allDays.length) || 0;
Â  const maxDay = Math.max(0, ...totals);

Â  // ĞŸĞ¾Ğ´ÑÑ‡ĞµÑ‚ ÑĞµÑ€Ğ¸Ğ¸ (streak)
Â  let streak = 0;
Â  let d = new Date();
Â  while (true) {
Â  Â  const key = d.toISOString().slice(0, 10);
Â  Â  if (history[key] && history[key].some(v => v > 0)) {
Â  Â  Â  streak++;
Â  Â  Â  d.setDate(d.getDate() - 1);
Â  Â  } else {
Â  Â  Â  break;
Â  Â  }
Â  }

Â  document.getElementById("stats").innerHTML = `
Â  Â  ğŸ”¢ Ğ’ÑĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ²: <b>${total}</b><br>
Â  Â  ğŸ“Š Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ Ğ² Ğ´ĞµĞ½ÑŒ: <b>${avg.toFixed(1)}</b><br>
Â  Â  ğŸ† Ğ ĞµĞºĞ¾Ñ€Ğ´Ğ½Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ: <b>${maxDay}</b><br>
Â  Â  ğŸ”¥ Ğ¡ĞµÑ€Ğ¸Ñ Ğ´Ğ½ĞµĞ¹ Ğ¿Ğ¾Ğ´Ñ€ÑĞ´: <b>${streak}</b>
Â  `;
Â  document.getElementById('streak-count').innerText = streak + ' Ğ´Ğ½.';
Â  const todaySum = history[todayKey()]?.reduce((a,b)=>a+b,0) || 0;
Â  document.getElementById('today-count').innerText = todaySum + ' Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ²';
}


// ====== Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ======
renderPermanent();
renderEditable();
updateStats();
renderChart();
</script>
</body>
</html>
